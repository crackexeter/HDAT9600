---
title: "Chapter 2 Team Exercise"
author: "Victor"
date: "27/02/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# load dataset
data(prostate, package="faraway")
# load required packages
library(tidyverse)
library(ggplot2)
```

## Exploratory Data Analysis

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r <EDA>, <options>}
# Data dictionary (source: https://rdrr.io/cran/faraway/man/prostate.html)
# lcavol log(cancer volume)
# lweight log(prostate weight)
# age age
# lbph log(benign prostatic hyperplasia amount)
# svi seminal vesicle invasion [0=no, 1=yes]
# lcp log(capsular penetration)
# gleason Gleason score
# pgg45 percentage Gleason scores 4 or 5
# lpsa log(prostate specific antigen)

# Examine dataset
dim(prostate) # dimensions of vector
str(prostate) # display structure
head(prostate) # first and last parts of object
summary(prostate)

# find minimum values for all variables
mins <- rep(0,9)
for(i in 1:9){
mins[i] <- min(prostate[,i])
}
mins

# find maximum values for all variables
maxs <- rep(0,9)
for(i in 1:9){
maxs[i] <- max(prostate[,i])
}
maxs

# output min and max into readable format
min_max <- data.frame(variable=colnames(prostate), min=mins, max=maxs)
print(min_max)

# examine missingness
table(is.na(prostate))

```
```{r, results='asis', message = FALSE, error = FALSE, warning = FALSE}

# Using log(PSA) as outcome value, these estimates were positively correlated
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$lcavol, y = prostate$lpsa))

# Using log(PSA) as outcome value, these estimates were positively correlated
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$lweight, y = prostate$lpsa))

# probably small positive correlation
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$gleason, y = prostate$lpsa))

# a lot of negative negative log capsular penetration values
# non negative values do seem to have positive correlation
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$lcp, y = prostate$lpsa))

# these estimates no correlation
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$age, y = prostate$lpsa))

# these estimates no correlation
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$pgg45, y = prostate$lpsa))

# this one has a lot of negative log BPH values with no correlation to log PSA
ggplot(data = prostate) + 
  geom_point(mapping = aes(x = prostate$lbph, y = prostate$lpsa))

# SVI == 0 trended lower log PSA than SVI == 1
ggplot(data=prostate, mapping=aes(x=prostate$lpsa, y=..density..)) + 
  geom_freqpoly(mapping = aes(colour=prostate$svi==0))


```

## Fitting linear models
```{r <linear_models>, <options>}
# fits a linear model, with the `lpsa` variable as the outcome (response), 
# and the `lcavol` variable as the single predictor
lcavol_mod <- lm(lpsa ~ lcavol, data=prostate)
summary(lcavol_mod)


# displays the R-squared and the residual standard error (RSE) for this model
summary(lcavol_mod)$adj.r.squared # this is the R squared
summary(lcavol_mod)$sigma # this is the RSE

# adds each of the variables `lweight`, `svi`, `lbph`, `age`, `lcp`, `pgg45` and 
# `gleason` to the model, one-by-one
lcavol_lweight_mod <- lm(lpsa ~ lcavol + lweight, data=prostate)
lcavol_lweight_svi_mod <- lm(lpsa ~ lcavol + lweight + svi, data=prostate)
lcavol_lweight_svi_lbph_mod <- lm(lpsa ~ lcavol + lweight + svi + lbph, data=prostate)
lcavol_lweight_svi_lbph_age_mod <- lm(lpsa ~ lcavol + lweight + svi + lbph + age, data=prostate)
lcavol_lweight_svi_lbph_age_lcp_mod <- lm(lpsa ~ lcavol + lweight + svi + lbph + age + lcp, data=prostate)
lcavol_lweight_svi_lbph_age_lcp_pgg45_mod <- lm(lpsa ~ lcavol + lweight + svi + lbph + age + lcp + pgg45, data=prostate)
lcavol_lweight_svi_lbph_age_lcp_pgg45_gleason_mod <- lm(lpsa ~ lcavol + lweight + svi + lbph + age + lcp + pgg45 + gleason, data=prostate)


# displays the R-squared and RSE for each of these models
summary(lcavol_lweight_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_mod)$sigma # this is the RSE

summary(lcavol_lweight_svi_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_svi_mod)$sigma # this is the RSE

summary(lcavol_lweight_svi_lbph_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_svi_lbph_mod)$sigma # this is the RSE

summary(lcavol_lweight_svi_lbph_age_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_svi_lbph_age_mod)$sigma # this is the RSE

summary(lcavol_lweight_svi_lbph_age_lcp_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_svi_lbph_age_lcp_mod)$sigma # this is the RSE

summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_mod)$sigma # this is the RSE

summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_gleason_mod)$adj.r.squared # this is the R squared
summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_gleason_mod)$sigma # this is the RSE

```

## Including Plots

You can also embed plots, for example:

```{r plots, echo=FALSE}
# creates two plots, one displaying the trend in R-squared as predictor variables 
# are successively added to each model, and another plot showing the trend in RSE 
# as predictor variables are successively added to each model


rsquared <- c(summary(lcavol_mod)$adj.r.squared,
              summary(lcavol_lweight_mod)$adj.r.squared,
              summary(lcavol_lweight_svi_mod)$adj.r.squared,
              summary(lcavol_lweight_svi_lbph_mod)$adj.r.squared,
              summary(lcavol_lweight_svi_lbph_age_mod)$adj.r.squared,
              summary(lcavol_lweight_svi_lbph_age_lcp_mod)$adj.r.squared,
              summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_mod)$adj.r.squared,
              summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_gleason_mod)$adj.r.squared)

rse <- c(summary(lcavol_mod)$sigma,
         summary(lcavol_lweight_mod)$sigma,
         summary(lcavol_lweight_svi_mod)$sigma,
         summary(lcavol_lweight_svi_lbph_mod)$sigma,
         summary(lcavol_lweight_svi_lbph_age_mod)$sigma,
         summary(lcavol_lweight_svi_lbph_age_lcp_mod)$sigma,
         summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_mod)$sigma,
         summary(lcavol_lweight_svi_lbph_age_lcp_pgg45_gleason_mod)$sigma)

plot(rsquared, xlab = "Number of predictor variables", ylab = "R squared")
plot(rse, , xlab = "Number of predictor variables", ylab = "Residual Standard Error")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
